import{r as x,j as e}from"./react-DiIsFRGf.js";import{d as t}from"./flowbite-react-moIAvRiJ.js";import{u as g,a as y}from"./react-redux-Cmcgb_ry.js";import{C as B,D as C,E as k}from"./react-icons-4Z_jIp8v.js";import{S as H}from"./SearchBar.jsx-D6SmUb86.js";import{B as _}from"./react-spinners-D_wes01j.js";import{r as p}from"./@material-tailwind-CfbTshu2.js";import{a as N,c as T}from"./@reduxjs-lV2PETub.js";import{_ as v}from"./react-hot-toast-BDpxPdYe.js";const F={bookings:[],loading:!1,error:null,hasApprovedBooking:!1,lastSeenBookingId:null},w=N("booking/approveBooking",async s=>{if((await(await fetch(`/server/booking/approve/${s}`,{method:"POST"})).json()).success)return s;throw new Error("Failed to approve booking")}),S=N("booking/rejectBooking",async s=>{if((await(await fetch(`/server/booking/reject/${s}`,{method:"POST"})).json()).success)return s;throw new Error("Failed to reject booking")}),b=T({name:"booking",initialState:F,reducers:{getBookingsStart:s=>{s.loading=!0},getBookingSuccess:(s,a)=>{s.bookings=a.payload,s.loading=!1,s.error=null},getBookingFailure:(s,a)=>{s.loading=!1,s.error=a.payload},setHasApprovedBooking:(s,a)=>{s.hasApprovedBooking=a.payload},setLastSeenBookingId:(s,a)=>{s.lastSeenBookingId=a.payload},bookingOut:s=>{s.bookings=null,s.loading=!1,s.error=null}},extraReducers:s=>{s.addCase(w.fulfilled,(a,n)=>{a.bookings=a.bookings.map(l=>l._id===n.payload?(a.lastSeenBookingId!==n.payload&&(a.hasApprovedBooking=!0),a.lastSeenBookingId=n.payload,{...l,status:"approved"}):l)}),s.addCase(S.fulfilled,(a,n)=>{a.bookings=a.bookings.map(l=>{l._id===n.payload&&{...l}})})}}),{getBookingsStart:P,getBookingSuccess:R,getBookingFailure:E,setHasApprovedBooking:q,setLastSeenBookingId:G}=b.actions,K=b.reducer;function Q(){const[s,a]=x.useState([]),{currentUser:n}=g(o=>o.user),{loading:l}=g(o=>o.booking),h=y();return x.useEffect(()=>{(async()=>{const m=`/server/booking/getuserbookings/${n._id}`;console.log("Fetching bookings from URL:",m);try{h(P());const c=await fetch(m);if(console.log("Response status:",c.status),!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const u=await c.json();h(R(u)),console.log("Booking data:",u);const r=u.map(i=>({...i})).sort((i,d)=>new Date(d.updatedAt)-new Date(i.updatedAt));a(r)}catch(c){h(E(c)),console.error("An error occurred while fetching booking details:",c)}})()},[n._id,h]),e.jsx(e.Fragment,{children:e.jsx("div",{className:`table-auto md:mx-auto p-3 scrollbar scrollbar-track-slate-100 scrollbar-thumb-slate-300 max-h-screen ${s&&s.length>0?"overflow-x-scroll":""}`,children:l?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh"},children:e.jsx(_,{color:"#10ebd8",loading:l,size:15})}):s&&s.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"Your Bookings :"}),e.jsxs(t,{hoverable:!0,className:"shadow-md w-full",children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Provider Name"}),e.jsx(t.HeadCell,{children:"Services"}),e.jsx(t.HeadCell,{children:"Scheduled Time"}),e.jsx(t.HeadCell,{children:"Session Type"}),e.jsx(t.HeadCell,{children:"Note"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Process"})]}),s.map(o=>e.jsx(t.Body,{className:"divide-y",children:e.jsxs(t.Row,{className:"bg-white text-gray-600",children:[e.jsx(t.Cell,{children:o.providerDetails.fullName}),e.jsx(t.Cell,{children:o.service.join(", ")}),e.jsx(t.Cell,{children:new Date(o.scheduledTime).toLocaleDateString()}),e.jsx(t.Cell,{children:o.sessionType}),e.jsx(t.Cell,{children:o.note}),e.jsxs(t.Cell,{children:[o.status==="pending"?e.jsx("p",{className:"",children:e.jsx(B,{})}):"",o.status==="approved"?e.jsx("p",{className:"",children:e.jsx(C,{})}):"",o.status==="rejected"?e.jsx("p",{className:"justify-center items-center",children:e.jsx(k,{})}):""]}),e.jsx(t.Cell,{children:o.status})]})},o._id))]})]}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5 max-h-screen",children:"No Bookings Yet"}),e.jsx("div",{className:"flex flex-col mx-auto items-center",children:e.jsx(H,{})})]})})})}function V(){const[s,a]=x.useState([]),[n,l]=x.useState({}),h=y(),{currentUser:o}=g(r=>r.user),m=x.useCallback(async r=>{const d=await(await fetch(`/server/booking/getbookings/${r}`)).json();if(d.success===!1)return;const j=d.sort((f,A)=>new Date(A.createdAt)-new Date(f.createdAt));a(j)},[]);x.useEffect(()=>{(async()=>{const d=await(await fetch(`/server/user/providers/${o._id}`)).json();d.success!==!1&&(l(d),d[0]&&m(d[0]._id))})()},[o._id,m]);const c=async r=>{h(w(r)).then(async()=>{v.success("Appointment Approved",{position:"bottom-left"}),n[0]&&m(n[0]._id);const i=s.find(f=>f._id===r),j=await(await fetch("/server/booking/emailbookingAccept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i.patientDetails.email,subject:"1Step Appointment Approved",providerName:n[0].fullName,service:i.service.join(", "),name:o.username,providerProfile:n[0].profilePicture,time:i.scheduledTime})})).json();if(j.success===!1){console.log("Email not sent");return}j.success===!0&&console.log("Email sent")})},u=async r=>{h(S(r)).then(()=>{v.error("Appointment Rejected",{position:"bottom-left"}),n[0]&&m(n[0]._id)})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-auto overflow-x-scroll md:mx-auto p-3 scrollbar scrollbar-track-slate-100 scrollbar-thumb-slate-300",children:s&&s.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"Your Appointments :"}),e.jsxs(t,{hoverable:!0,className:"shadow-md w-full",children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Patient Name"}),e.jsx(t.HeadCell,{children:"Services they Need"}),e.jsx(t.HeadCell,{children:"Scheduled Time"}),e.jsx(t.HeadCell,{children:"Session Type"}),e.jsx(t.HeadCell,{children:"Note"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Action"})]}),s.map(r=>e.jsx(t.Body,{className:"divide-y",children:e.jsxs(t.Row,{className:"bg-white text-gray-600",children:[e.jsx(t.Cell,{children:r.patientDetails.username}),e.jsx(t.Cell,{children:r.service.join(", ")}),e.jsx(t.Cell,{children:r.scheduledTime}),e.jsx(t.Cell,{children:r.sessionType}),e.jsx(t.Cell,{children:r.note}),e.jsxs(t.Cell,{children:[r.status==="pending"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(B,{})}):"",r.status==="approved"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(C,{})}):"",r.status==="rejected"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(k,{})}):""]}),e.jsx(t.Cell,{className:"flex flex-row gap-2",children:r.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(p.Button,{className:"bg-emerald-600",disabled:r.status==="approved",children:"Accepted"}),e.jsx(p.Button,{className:"bg-red-500",onClick:()=>u(r._id),children:"Reject"})]}):r.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(p.Button,{className:"bg-emerald-600",onClick:()=>c(r._id),children:"Accept"}),e.jsx(p.Button,{className:"bg-red-500",onClick:()=>u(r._id),disabled:r.status==="rejected",children:"Reject"})]}):r.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsx(p.Button,{className:"bg-emerald-600",onClick:()=>c(r._id),children:"Accepted"}),e.jsx(p.Button,{className:"bg-red-500",onClick:()=>u(r._id),disabled:r.status==="rejected",children:"Rejected"})]}):""})]})},r._id))]})]}):e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"No Appointment Yet"})})})}export{V as P,Q as U,G as a,R as b,E as c,K as d,P as g,q as s};
