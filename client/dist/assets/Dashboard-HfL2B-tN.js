import{r as a,j as e}from"./react-DiIsFRGf.js";import{S as J,C as we,T as Ie,a as g}from"./flowbite-react-Fyy4migT.js";import{c as ze,M as He,I as Oe,d as Ye,H as qe,e as je,G as ce,P as Se,B as _e,f as Ce,g as Ge,h as We,i as Ve,j as De,k as Pe,l as ke,m as Ke}from"./react-icons-8x28c1Op.js";import{b as me}from"./react-router-DJddit7Q.js";import{L as ie}from"./react-router-dom-CiSQRV_j.js";import{u as X,a as E}from"./react-redux-Dbcc7wIi.js";import{p as Je,s as Qe,u as xe,a as he,b as ve,c as Me,d as Be,e as Xe,S as Ae,g as $e,h as Fe,i as Te,j as be,k as Ne,m as Ze,r as es,n as ss}from"./index-WeOTgdyh.js";import ts from"./Profile-C64_ht95.js";import{_ as fe,B as rs}from"./react-spinners-D_wes01j.js";import{_ as H}from"./react-hot-toast-BDpxPdYe.js";import{u as de}from"./react-top-loading-bar-BLjLFdAM.js";import{S as as}from"./react-select-xtze-_c4.js";import{I as ye}from"./react-phone-number-input-ASBvvjCp.js";import{r as Q}from"./@material-tailwind-CfbTshu2.js";import{l as Ee}from"./socket.io-client-DFi9RC7o.js";import ls from"./CreateProvider-8nUtNUho.js";import{C as Le}from"./react-content-loader-DBgsaXRA.js";import"./mongoose-DJKLpne1.js";import{R as Re}from"./react-time-ago-D1AjiSwC.js";import"./@floating-ui-DNv8sKgv.js";import"./aria-hidden-DQ5UC2Eg.js";import"./tabbable-DNPBiPWX.js";import"./react-dom-byw35-pb.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-Dj_uVd1O.js";import"./use-sync-external-store-CLl2ARCe.js";import"./typewriter-effect-BuJ_1VG0.js";import"./country-state-city-B5NRDuuX.js";import"./prop-types-DepTH4Nk.js";import"./firebase-CbIrmIWz.js";import"./@firebase-Bu6QwI_o.js";import"./idb-BXWtuYvb.js";import"./tslib-DM0Z-3HQ.js";import"./@reduxjs-lV2PETub.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./redux-persist-BVedYr7E.js";import"./javascript-time-ago-BndSdHl7.js";import"./relative-time-format-Cuui0pOH.js";import"./@babel-CabbEptY.js";import"./@emotion-CEC3ZH7r.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-YPZU7XtI.js";import"./use-isomorphic-layout-effect-YmIeajr3.js";import"./memoize-one-BdPwpGay.js";import"./classnames-BarBPuyi.js";import"./tailwind-merge-BXtt6hLZ.js";import"./framer-motion-aHfq1aqb.js";import"./hey-listen-CLGyRvAf.js";import"./style-value-types-Pspc_Zm6.js";import"./popmotion-CLyVFpOP.js";import"./framesync-BCkQ-MAm.js";import"./@motionone-0R8ZHWcy.js";import"./material-ripple-effects-BS6XNNYc.js";import"./goober-vt3s6TGe.js";import"./libphonenumber-js-fczAwKKS.js";import"./input-format-C2kHUKsc.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./raf-CYl_x6me.js";import"./performance-now-C2UHO3W-.js";function ns(){const t=me(),[N,h]=a.useState(""),S=X();E(s=>s.user),a.useEffect(()=>{const i=new URLSearchParams(t.search).get("tab");i&&h(i)},[t.search]);const p=async()=>{try{const s=await fetch("/server/auth/signout",{method:"GET"}),i=await s.json();s.ok?(S(Je()),S(Qe())):console.log(i.message)}catch(s){console.log(s.message)}};return e.jsx(J,{className:"w-full items-center justify-center mx-auto",children:e.jsx(J.Items,{children:e.jsxs(J.ItemGroup,{className:"flex flex-row gap-2 items-center",children:[e.jsx(ie,{to:"/dashboard?tab=dashboard",children:e.jsx(J.Item,{active:N==="dashboard",className:"mt-2",icon:ze,labelColor:"light",as:"div",children:"Dashboard"})}),e.jsx(ie,{to:"/dashboard?tab=providers",children:e.jsx(J.Item,{active:N==="providers",icon:He,labelColor:"light",as:"div",children:"Providers"})}),e.jsx(ie,{to:"/dashboard?tab=messages",children:e.jsx(J.Item,{active:N==="messages",icon:Oe,labelColor:"light",as:"div",children:"Message"})}),e.jsx(ie,{to:"/dashboard?tab=profile",children:e.jsx(J.Item,{active:N==="profile",icon:Ye,labelColor:"light",as:"div",children:"Profile"})}),e.jsx(J.Item,{icon:qe,className:"cursor-pointer",onClick:p,children:"Sign Out"})]})})})}function is(){return e.jsx("div",{children:"Overview Component"})}function os(){var A,O,G,T,ee,W,se,te,ae,le,l,v,C,r,m,o;const{currentUser:t,error:N}=E(n=>n.user),h=X(),[S,p]=a.useState(!1),[s,i]=a.useState(!1),b=a.useRef(null),[x,c]=a.useState(),[j,y]=a.useState(),[P,k]=a.useState(!1),[M,U]=a.useState(!0),[F,L]=a.useState(!0),[f,R]=a.useState({isParent:!1,parentDetails:{fullName:"",lookingFor:[],childName:"",dob:"",gender:"",height:"",weight:"",bloodGroup:"",medicalHistory:"",allergies:"",emergencyContact:j,insurance:"",address:"",phoneNumber:x}}),q=[{value:"Diagnostic Evaluation",label:"Diagnostic Evaluation"},{value:"Speech Therapy",label:"Speech Therapy"},{value:"ABA Therapy",label:"ABA Therapy"},{value:"Occupational Therapy",label:"Occupational Therapy"},{value:"School-Based Service",label:"School-Based Service"},{value:"Dance Movement",label:"Dance Movement"},{value:"Art as Therapy",label:"Art as Therapy"},{value:"Counselling",label:"Counselling"}],B=n=>{let d=n.target.value;n.target.id==="phoneNumber"&&(d.length!==10?U(!1):U(!0)),n.target.id==="isParent"?(d=n.target.value==="Yes",R({...f,isParent:d})):R({...f,parentDetails:{...f.parentDetails,[n.target.id]:d}}),k(!0)},Z=async n=>{var d,u;if(n.preventDefault(),!!P){if(((d=f.parentDetails)==null?void 0:d.phoneNumber.length)!==13){H.error("Phone number should be 10 digits"),U(!1);return}else U(!0);if(((u=f.parentDetails)==null?void 0:u.emergencyContact.length)!==13){H.error("Emergency Contact should be 10 digits"),L(!1);return}else L(!0);h(xe());try{b.current.continuousStart(50),h(xe()),i(!0);const _=await(await fetch(`server/parent/updateparent/${t._id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).json();if(_.success===!1){h(he(_));return}h(ve(_)),f.isParent?H.success("Parent details updated successfully"):H.error("Parent Details Successfully Removed"),i(!1)}catch(w){h(he(w))}finally{b.current.complete()}}};return a.useEffect(()=>{(async()=>{var d,u,w,_,D,I,Y,V,K,z,oe,ne,re,ge,pe;h(xe()),p(!0);try{const $=await(await fetch(`server/parent/getparent/${t._id}`)).json();if($.success===!1)return;const Ue={isParent:$.isParent||!1,lookingFor:((d=$.parentDetails)==null?void 0:d.lookingFor)||[],childName:((u=$.parentDetails)==null?void 0:u.childName)||"",fullName:((w=$.parentDetails)==null?void 0:w.fullName)||"",dob:(_=$.parentDetails)!=null&&_.dob?new Date((D=$.parentDetails)==null?void 0:D.dob).toISOString().split("T")[0]:"",gender:((I=$.parentDetails)==null?void 0:I.gender)||"",height:((Y=$.parentDetails)==null?void 0:Y.height)||"",weight:((V=$.parentDetails)==null?void 0:V.weight)||"",bloodGroup:((K=$.parentDetails)==null?void 0:K.bloodGroup)||"",medicalHistory:((z=$.parentDetails)==null?void 0:z.medicalHistory)||"",allergies:((oe=$.parentDetails)==null?void 0:oe.allergies)||"",emergencyContact:((ne=$.parentDetails)==null?void 0:ne.emergencyContact)||"",insurance:((re=$.parentDetails)==null?void 0:re.insurance)||"",address:((ge=$.parentDetails)==null?void 0:ge.address)||"",phoneNumber:((pe=$.parentDetails)==null?void 0:pe.phoneNumber)||""};R({isParent:$.isParent||!1,parentDetails:Ue}),h(ve($))}catch(ue){console.log(ue),h(he(ue))}p(!1)})()},[t._id,h]),e.jsxs("div",{className:"p-7 flex-col items-center rounded-lg",children:[e.jsx(de,{ref:b,color:"#ff9900",height:3}),S?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(fe,{color:"#10ebd8",loading:S,size:15})}):e.jsxs("form",{onSubmit:Z,className:"flex flex-col sm:flex-row md:gap-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col flex-1 gap-2",children:[e.jsx("label",{htmlFor:"isParent",className:"text-sm font-semibold text-main",children:"Are you a parent?"}),e.jsxs("select",{id:"isParent",name:"isParent",value:f.isParent?"Yes":"No",onChange:B,className:"input border-2 p-2 rounded-lg focus:ring-0",required:!0,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]}),e.jsx("label",{htmlFor:"gender",className:"text-sm font-semibold text-main",children:"Gender:"}),e.jsxs("select",{id:"gender",name:"gender",value:(A=f.parentDetails)==null?void 0:A.gender,onChange:B,className:"input border-2 p-2 rounded-lg  focus:outline-none focus:ring-0",required:!0,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx("label",{className:"text-sm font-semibold text-main",children:"BloodGroup*"}),e.jsx("input",{type:"text",placeholder:"BloodGroup",className:"input border-2 p-2 rounded-lg focus:outline-none focus:ring-0",id:"bloodGroup",required:!0,onChange:B,value:(O=f.parentDetails)==null?void 0:O.bloodGroup}),e.jsx("label",{htmlFor:"gender",className:"text-sm font-semibold text-main",children:e.jsxs("p",{className:"flex flex-row items-center",children:[!F&&e.jsx(je,{className:"text-red-700 text-sm"}),"Emergency Contact :"," "]})}),e.jsx(ye,{placeholder:"Emergency Contact",className:`border-2 p-2 input rounded-lg focus:outline-none focus:ring-0 ${M?"":"error"}`,value:(G=f.parentDetails)==null?void 0:G.emergencyContact,onChange:n=>{y(n),R({...f,parentDetails:{...f.parentDetails,emergencyContact:n}}),k(!0)},required:!0}),!F&&e.jsx("p",{className:"text-sm text-red-500 font-semibold",children:"Please enter a 10-digit number"}),e.jsx("label",{htmlFor:"gender",className:"text-sm font-semibold text-main",children:"Address : (city, state, pincode)"}),e.jsx("textarea",{type:"text",placeholder:"Address",className:"border-2 p-2 rounded-lg input focus:outline-none focus:ring-0",id:"address",required:!0,onChange:B,value:(T=f.parentDetails)==null?void 0:T.address})]}),e.jsxs("div",{className:"flex flex-col flex-1 gap-2 w-full",children:[e.jsx("label",{name:"fullName",className:"text-sm font-semibold text-main",children:"Enter your Full Name :"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"input border-2 p-2 rounded-lg focus:ring-0",id:"fullName",maxLength:"62",minLength:"5",required:!0,onChange:B,value:(ee=f.parentDetails)==null?void 0:ee.fullName}),e.jsx("label",{name:"fullName",className:"text-sm font-semibold text-main",children:"Enter your DOB :"}),e.jsx("input",{type:"date",placeholder:"Date of Birth",className:"input border-2 p-2 rounded-lg  focus:ring-0",id:"dob",required:!0,onChange:B,value:(W=f.parentDetails)==null?void 0:W.dob}),e.jsx("label",{className:"text-sm font-semibold text-main",children:"Height*"}),e.jsx("input",{type:"text",placeholder:"Height",className:"input border-2 p-2 rounded-lg  focus:outline-none focus:ring-0",id:"height",required:!0,onChange:B,value:(se=f.parentDetails)==null?void 0:se.height}),e.jsx("label",{className:"text-sm font-semibold text-main",children:"Medical History*"}),e.jsx("input",{type:"text",placeholder:"Medical History",className:"input border-2 p-2 rounded-lg focus:outline-none focus:ring-0",id:"medicalHistory",required:!0,onChange:B,value:(te=f.parentDetails)==null?void 0:te.medicalHistory}),e.jsx("label",{htmlFor:"gender",className:"text-sm font-semibold text-main",children:"Insurance :"}),e.jsx("input",{type:"text",placeholder:"Insurance",className:"border-2 p-2 rounded-lg input focus:outline-none focus:ring-0",id:"insurance",required:!0,onChange:B,value:(ae=f.parentDetails)==null?void 0:ae.insurance})]}),e.jsxs("div",{className:"flex flex-col flex-1 gap-2 w-full",children:[e.jsx("label",{name:"fullName",className:"text-sm font-semibold text-main",children:"What therapy your looking for?"}),e.jsx(as,{id:"name",options:q,isMulti:!0,required:!0,placeholder:"looking for?",touchUi:!1,className:"border-2 rounded-lg border-slate-300 bg-white input hover:border-purple-400",defaultValue:Array.isArray((le=f.parentDetails)==null?void 0:le.lookingFor)?(l=f.parentDetails)==null?void 0:l.lookingFor.map(n=>q.find(d=>d.value===n)):[],onChange:n=>{R(d=>({...d,parentDetails:{...d.parentDetails,lookingFor:n.map(u=>u.value)}})),k(!0)},styles:{control:n=>({...n,backgroundColor:"transparent",minWidth:"160px",border:"none",outline:"none",boxShadow:"none",transition:"all 0.3s ease"})}},(v=f.parentDetails)==null?void 0:v.lookingFor),e.jsx("label",{className:"text-sm font-semibold text-main",children:"Child Name*"}),e.jsx("input",{type:"text",placeholder:"Child Name",className:"input border-2 p-2 rounded-lg focus:outline-none focus:ring-0 ",id:"childName",required:!0,onChange:B,value:(C=f.parentDetails)==null?void 0:C.childName}),e.jsx("label",{className:"text-sm font-semibold text-main",children:"Weight*"}),e.jsx("input",{type:"text",placeholder:"Weight",className:"input border-2 p-2 rounded-lg focus:outline-none focus:ring-0 ",id:"weight",required:!0,onChange:B,value:(r=f.parentDetails)==null?void 0:r.weight}),e.jsx("label",{className:"text-sm font-semibold text-main",children:"Allergies :"}),e.jsx("input",{type:"text",placeholder:"Allergies",className:"input border-2 p-2 rounded-lg focus:outline-none focus:ring-0",id:"allergies",required:!0,onChange:B,value:(m=f.parentDetails)==null?void 0:m.allergies}),e.jsx("label",{className:"text-sm font-semibold text-main",children:e.jsxs("p",{className:"flex flex-row items-center",children:[!M&&e.jsx(je,{className:"text-red-700 text-sm"}),"Phone Number :"," "]})}),e.jsx(ye,{placeholder:"Enter phone number",className:`border-2 p-2 input rounded-lg focus:outline-none focus:ring-0 ${M?"":"error"}`,value:(o=f.parentDetails)==null?void 0:o.phoneNumber,onChange:n=>{c(n),R({...f,parentDetails:{...f.parentDetails,phoneNumber:n}}),k(!0)},required:!0}),!M&&e.jsx("p",{className:"text-sm text-red-500 font-semibold",children:"Please enter a 10-digit number"}),e.jsx("button",{disabled:!P||S,className:"p-2 btn-color rounded-lg mt-8 font-semibold rounded=lg uppercase hover:opacity-95 disabled:opacity-60 transition ease-in-out duration-300",children:s?"Saving...":"Save"}),N&&e.jsx("p",{className:"text-red-700 text-xs",children:N})]})]})]})}function cs(){const{currentUser:t}=E(l=>l.user),{onlineAllUsers:N}=E(l=>l.online),{id:h}=E(l=>l.provider),[S,p]=a.useState([]),[s,i]=a.useState(null),[b,x]=a.useState([]),[c,j]=a.useState([]),[y,P]=a.useState([]),[k,M]=a.useState(!0),[U,F]=a.useState(!0),L=a.useRef(null),f=a.useRef(null),[R,q]=a.useState(!1),B=X(),Z="http://localhost:3000",[A,O]=a.useState(null),[G,T]=a.useState("");a.useEffect(()=>{const l=Ee(Z,{withCredentials:!0});return O(l),l.emit("Online",t._id),l.on("UserOnline",({userId:v})=>{B(Me(v))}),l.on("UserOut",({userId:v})=>{B(Be(v))}),()=>l.close()},[t._id,B]),a.useEffect(()=>{if(!A)return;const l=({sender:v,message:C,provider:r})=>{if(r!==h){H.success("New message received");return}const m={sender:v,message:C,provider:r,createdAt:new Date};j(o=>[...o,m]),P(o=>[...o,m]),p(o=>o.map(d=>d._id===h?{...d,lastMessage:m}:d))};return A.on("receiveMessage",l),()=>A.off("receiveMessage",l)},[A,h]);const ee=()=>{if(G==="")return H.error("Message cannot be empty");A&&(A.emit("joinRoom",{roomId:`${t._id}_${s._id}`,sender:t._id,provider:s._id,reciever:s.userRef}),A.emit("sendMessage",{roomId:`${t._id}_${s._id}`,message:G,sender:t._id,provider:s._id,userid:t._id,reciever:s.userRef}),T(""))};a.useEffect(()=>{if(s&&A){const l=`${t._id}_${s._id}`;return A.emit("joinRoom",{roomId:l,sender:t._id,provider:s._id,reciever:s.userRef}),A.on("messageRead",v=>{P(C=>C.map(r=>r._id===v?{...r,read:!0}:r))}),()=>{A.off("messageRead")}}},[s,A,t._id]),a.useEffect(()=>{(async()=>{M(!0),f.current.continuousStart();try{const C=await(await fetch(`/server/message/getprovider/${t._id}`)).json();if(C.success===!1){M(!1),F(!1);return}p(C),f.current.complete(50),M(!1)}catch(v){M(!1),console.log(v)}})()},[t._id]);const W=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),ee())};a.useEffect(()=>{const l=()=>{L.current&&L.current.scrollTop<=10&&se()};if(L.current){const v=L.current;return v.addEventListener("scroll",l),()=>{v&&v.removeEventListener("scroll",l)}}},[y]);const se=()=>{const v=y.length,C=b.slice(Math.max(0,b.length-v-10),b.length-v);P(r=>[...C,...r])},te=()=>{if(L.current){const{scrollHeight:l,clientHeight:v}=L.current,C=l-v;L.current.scrollTop=C>0?C:0}};a.useEffect(()=>{te()},[c,b]);const ae=()=>{q(!0)},le=async l=>{i(l),q(!1);const v=`${t._id}_${l._id}`;try{const r=await(await fetch(`/server/message/getmessage/${v}`)).json();if(r.success===!1)return;x(r),P(r.slice(-10));const m=r.filter(o=>!o.read&&o.sender!==t._id);console.log("unreadMessages",m),await Promise.all(m.map(async o=>fetch(`/server/message/markasread/${o._id}`,{method:"PUT",headers:{"Content-Type":"application/json"}}))),P(o=>o.map(n=>n.sender!==t._id?{...n,read:!0}:n)),p(o=>o.map(d=>{var u;return d._id===l._id&&((u=d.lastMessage)==null?void 0:u.sender)!==t._id?{...d,lastMessage:{...d.lastMessage,read:!0}}:d}))}catch(C){console.log(C)}};return a.useEffect(()=>{(async()=>{try{M(!0),F(!0);const C=await(await fetch(`/server/message/getprovider/${t._id}`)).json();if(C.success===!1){M(!1),F(!1);return}const m=(await Promise.all(C.map(async o=>{const n=`${t._id}_${o._id}`,[d,u]=await Promise.all([fetch(`/server/message/getlastmessage/${n}`),fetch(`/server/message/getunreadmessagescount/${n}?reciever=${t._id}`)]),w=await d.json(),_=await u.json();return console.log("unreadData",_),{...o,lastMessage:w||"No message yet",unreadCount:_.unreadCount}}))).sort((o,n)=>{const d=new Date(o.lastMessage.createdAt);return new Date(n.lastMessage.createdAt)-d});p(m),F(!1),M(!1)}catch(v){M(!1),console.log(v)}})()},[t._id]),e.jsxs("div",{className:"full-height flex flex-col",children:[e.jsx(de,{color:"#722a88",ref:f,height:3,speed:1e3}),k?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh"},children:e.jsx(fe,{color:"#AFDBD8",loading:k,size:20})})}):e.jsxs(e.Fragment,{children:[e.jsx(de,{color:"#ff9900",ref:f,height:3,speed:1e3}),S.length>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-grow h-screen max-h-[460px] 2xl:max-h-[745px]",children:[e.jsx("div",{className:"w-1/4 flex flex-col items-center pt-2 pr-2 gap-2",children:S.length>0?e.jsx(e.Fragment,{children:U&&!k?e.jsx(e.Fragment,{children:S.map(l=>e.jsxs(Le,{height:80,width:290,speed:2,viewBox:"0 0 250 60",backgroundColor:"#f5f5f5",foregroundColor:"#D1BEE0",className:"2xl:w-[900px] 2xl:h-[110px]",children:[e.jsx("circle",{cx:"127",cy:"35",r:"25",className:"md:hidden block"}),e.jsx("circle",{cx:"30",cy:"35",r:"25",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"20",width:"140",height:"8",rx:"4",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"40",width:"80",height:"8",rx:"4",className:"hidden md:block"})]},l._id))}):e.jsx(e.Fragment,{children:S.map(l=>{var C,r,m,o,n,d;const v=s&&s._id===l._id;return e.jsxs("div",{className:`w-full p-4 flex chatbox-color gap-5 border-b-2 items-center cursor-pointer ${v?"chat-selected":"messagebg"}`,onClick:()=>{B(Xe(l._id)),le(l)},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l.profilePicture,alt:"provider logo",className:"w-9 h-9 2xl:size-20 md:w-12 md:h-12 rounded-full object-cover"}),N[l._id]?e.jsx(ce,{className:"absolute top-0 right-0 text-green-400 transition-all ease-in duration-150"}):e.jsx(ce,{className:"absolute top-0 right-0 text-red-400 transition-all ease-in duration-150"})]}),e.jsxs("div",{className:"flex-grow hidden md:block",children:[e.jsx("p",{className:"font-semibold items-center justify-center",children:l.fullName.slice(0,15)}),e.jsx("div",{className:"flex flex-row gap-1",children:e.jsxs("p",{className:`text-sm line-clamp-1 ${!((C=l.lastMessage)!=null&&C.read)&&((r=l.lastMessage)==null?void 0:r.sender)!==t._id?"text-gray-700 font-bold":""}`,children:[(m=l.lastMessage)==null?void 0:m.message.slice(0,20),((o=l.lastMessage)==null?void 0:o.message.length)>20?"....":""]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{style:{fontSize:"11px"},className:"hidden md:block",children:e.jsx("span",{className:"ml-2",style:{fontSize:"12px"},children:(()=>{var V;const u=new Date(((V=l.lastMessage)==null?void 0:V.createdAt)||0),w=new Date,_=w-u,D=24*60*60*1e3,I=7*D,Y=K=>{const z=new Date(w);return z.setDate(z.getDate()-1),K.getDate()===z.getDate()&&K.getMonth()===z.getMonth()&&K.getFullYear()===z.getFullYear()};return _<D?u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):Y(u)?"Yesterday":_<I?u.toLocaleDateString([],{weekday:"long"}):u.toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric"})})()})}),e.jsx("div",{children:!((n=l.lastMessage)!=null&&n.read)&&((d=l.lastMessage)==null?void 0:d.sender)!==t._id&&e.jsx("div",{className:"bg-purple-400 rounded-full w-4 h-4 flex justify-center items-center",children:e.jsx("p",{className:"font-bold",style:{fontSize:"10px"},children:l.unreadCount})})})]})]},l._id)})})}):e.jsx(e.Fragment,{children:"no messages found"})}),e.jsx("div",{className:"w-3/4 p-4 flex flex-col rightchatbox-color overflow-hidden",children:s?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:`transition-all ease-in-out duration-200 ${R?"md:w-3/4":"w-full"}`,children:[e.jsxs("div",{className:`flex flex-row items-center mb-4 justify-between border-b-2 border-purple-500 ${R?"":"cursor-pointer"}`,onClick:ae,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("img",{src:s.profilePicture,alt:"provider logo",className:"w-12 h-10 md:h-12 md rounded-full object-cover"}),e.jsx("div",{className:"flex flex-row items-center text-start",children:e.jsxs("div",{className:"items-center",children:[e.jsx("h2",{className:"flex flex-row ml-2 capitalize font-semibold",children:s.fullName}),N[s._id]?e.jsx("div",{className:"text-xs text-start ml-2 fadeIn",children:"Online"}):e.jsx("div",{className:"text-xs text-start  ml-2",children:"Offline"})]})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(Se,{className:"size-6"})})]}),e.jsxs("div",{className:"flex flex-col flex-grow h-screen",children:[e.jsx("div",{ref:L,className:" overflow-y-scroll h-[320px] md:h-[290px] 2xl:h-[600px]",children:y.map(l=>e.jsxs("div",{className:"m-2",children:[e.jsxs("div",{className:`flex items-center ${String(l.sender)===String(t._id)?"justify-end":""}`,children:[l.sender!==t._id&&e.jsx("img",{src:s.profilePicture,alt:"provider logo",className:"size-9 rounded-full mr-2 object-cover"}),e.jsxs("div",{className:`p-2 text-xs md:text-base ${l.sender===t._id?"chat-sender rounded-l-xl rounded-tr-xl":"bg-gray-300 rounded-r-xl rounded-tl-xl"} ${l.message.length>30?"w-2/3":"w-max"}`,children:[l.message,e.jsx("span",{className:"ml-2",style:{fontSize:"10px"},children:new Date(l.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),l.sender===t._id&&e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-9 rounded-full ml-2 object-cover"})]}),e.jsx("div",{className:`${l.sender===t._id?"mr-10 text-right":"ml-10 text-left"}`,style:{fontSize:"12px"},children:e.jsx(Re,{locale:"en-US",date:new Date(l.createdAt)})})]},l._id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Type a message...",className:"w-full p-3 rounded-lg",value:G,onKeyDown:W,onChange:l=>T(l.target.value)}),e.jsx(Q.Button,{onClick:ee,variant:"outlined",className:"btn-color border-gray-400",children:e.jsx(_e,{className:"size-5"})})]})]})]}),R&&e.jsxs("div",{className:"w-1/3 p-2 pr-2 md:block hidden border-l-2 mt-2",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2 mb-3",children:[e.jsx(Ce,{className:"size-6 text-gray cursor-pointer",onClick:()=>q(!1)}),e.jsx("p",{className:"text-base font-semibold",children:"Contact info"})]}),e.jsx(we,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:s.profilePicture,alt:"user logo",className:"size-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row justify-center items-center gap-1",children:[e.jsx("h2",{className:"capitalize font-semibold mt-2 provideritem-name",children:s.fullName}),s.verified===!0&&e.jsx(e.Fragment,{children:e.jsx(Ie,{content:"Verifed Profile",animation:"duration-500",children:e.jsx(Ge,{className:"animate-bounce size-4 mt-2"})})})]}),e.jsx("p",{className:"text-xs text-center provideritem-service",children:Array.isArray(s.name)?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:s.name.slice(0,2).join(", ")}),s.name.length>2?e.jsx("p",{children:s.name.slice(2).join(", ")}):null,s.name.length>3?e.jsx(e.Fragment,{children:e.jsx("p",{children:`+${s.name.length-2}more`})}):null]}):e.jsx(e.Fragment,{children:s.name})})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(We,{className:"h-4 w-4 icon-color"}),e.jsxs("p",{className:"text-sm provideritem-service",children:[e.jsx("span",{className:"text-xs provideritem-service",children:s.experience}),"Â years experience"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-4 w-4 icon-color"}),e.jsxs("p",{className:"text-sm provideritem-service truncate w-full",children:[s.address.state,",",s.address.city]})]})]})})]})]}):e.jsxs("div",{className:"flex flex-col mx-auto items-center justify-center h-full",children:[e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-20 object-cover rounded-full border-4 border-purple-300"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray",children:["Hi,",e.jsx("span",{className:"animate-wave",children:"ðŸ‘‹ðŸ»"}),"Welcome!"]}),e.jsx("h2",{className:"text-gray",children:"Select a provider for chat."})]})})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col w-full max-h-screen p- mx-auto",children:[e.jsx("div",{className:"h-52vh md:h-72vh bg-nomsgbg bg-cover bg-center flex flex-col justify-center items-center text-white",children:e.jsxs("div",{children:[e.jsx("h1",{className:"flex flex-col items-center text-4xl font-bold  text-gray-700",children:"No Messages yet"}),e.jsx("h1",{className:"flex flex-col items-center text-2xl font-semibold mt-6 text-zinc-600",children:"To begin, search for a provider and send them a message."})]})}),e.jsx("div",{className:"flex items-center justify-center mt-6",children:e.jsx(Ae,{})})]})})]})]})}function ds(){const[t,N]=a.useState([]),{currentUser:h}=E(s=>s.user),{loading:S}=E(s=>s.booking),p=X();return a.useEffect(()=>{(async()=>{const i=`/server/booking/getuserbookings/${h._id}`;console.log("Fetching bookings from URL:",i);try{p($e());const b=await fetch(i);if(console.log("Response status:",b.status),!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const x=await b.json();p(Fe(x)),console.log("Booking data:",x);const c=x.map(j=>({...j})).sort((j,y)=>new Date(y.updatedAt)-new Date(j.updatedAt));N(c)}catch(b){p(Te(b)),console.error("An error occurred while fetching booking details:",b)}})()},[h._id,p]),e.jsx(e.Fragment,{children:e.jsx("div",{className:`table-auto md:mx-auto p-3 scrollbar scrollbar-track-slate-100 scrollbar-thumb-slate-300 max-h-screen ${t&&t.length>0?"overflow-x-scroll":""}`,children:S?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh"},children:e.jsx(rs,{color:"#10ebd8",loading:S,size:15})}):t&&t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"Your Bookings :"}),e.jsxs(g,{hoverable:!0,className:"shadow-md w-full",children:[e.jsxs(g.Head,{children:[e.jsx(g.HeadCell,{children:"Provider Name"}),e.jsx(g.HeadCell,{children:"Services"}),e.jsx(g.HeadCell,{children:"Scheduled Time"}),e.jsx(g.HeadCell,{children:"Session Type"}),e.jsx(g.HeadCell,{children:"Note"}),e.jsx(g.HeadCell,{children:"Status"}),e.jsx(g.HeadCell,{children:"Process"})]}),t.map(s=>e.jsx(g.Body,{className:"divide-y",children:e.jsxs(g.Row,{className:"bg-white text-gray-600",children:[e.jsx(g.Cell,{children:s.providerDetails.fullName}),e.jsx(g.Cell,{children:s.service.join(", ")}),e.jsx(g.Cell,{children:new Date(s.scheduledTime).toLocaleDateString()}),e.jsx(g.Cell,{children:s.sessionType}),e.jsx(g.Cell,{children:s.note}),e.jsxs(g.Cell,{children:[s.status==="pending"?e.jsx("p",{className:"",children:e.jsx(De,{})}):"",s.status==="approved"?e.jsx("p",{className:"",children:e.jsx(Pe,{})}):"",s.status==="rejected"?e.jsx("p",{className:"justify-center items-center",children:e.jsx(ke,{})}):""]}),e.jsx(g.Cell,{children:s.status})]})},s._id))]})]}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5 max-h-screen",children:"No Bookings Yet"}),e.jsx("div",{className:"flex flex-col mx-auto items-center",children:e.jsx(Ae,{})})]})})})}function ms(){const[t,N]=a.useState("Profile setting");E(j=>j.user);const[h,S]=a.useState(!1),p=me(),s=X(),{bookings:i,hasApprovedBooking:b,lastSeenBookingId:x}=E(j=>j.booking),c=a.useMemo(()=>[{title:"Profile setting"},{title:"Parent Details"},{title:"Bookings"}],[]);return a.useEffect(()=>{t!=="Bookings"&&S(!1)},[t]),a.useEffect(()=>{if(Array.isArray(i)){const j=i.filter(y=>y.status==="approved");if(j.length>0){const y=j[j.length-1];y._id!==x&&(s(be(!0)),s(Ne(y._id)))}}},[i,s,x]),a.useEffect(()=>{const y=new URLSearchParams(p.search).get("tag");y&&c.find(k=>k.title===y)&&N(y)},[p.search,c]),e.jsxs("div",{className:"flex flex-col w-full transition-all duration-500 ",children:[e.jsx("nav",{className:"block border-b items-start",children:e.jsx("ul",{className:" flex items-center gap-x-3 max-w-screen-2xl mx-auto px-4 overflow-x-auto lg:px-8",children:c.map((j,y)=>e.jsx("li",{className:"py-1",children:e.jsx(ie,{to:`?tag=${j.title}`,className:`block py-2 px-3 rounded-lg md:text-base text-sm text-gray-700 hover:text-amber-500 hover:bg-amber-100 duration-150 ${t===j.title?"border-b-2 border-amber-500":""}`,onClick:()=>{if(j.title==="Bookings"){S(!1);const P=i.filter(k=>k.status==="approved");if(P.length>0){const k=P[P.length-1];s(Ne(k._id)),s(be(!1))}}},children:e.jsxs("span",{className:"flex flex-row items-center gap-1",children:[j.title,j.title==="Bookings"&&b&&e.jsx(Ke,{})]})})},y))})}),t==="Profile setting"&&e.jsx("div",{className:"w-full min-h-screen transition-all duration-500",children:e.jsx(ts,{})}),t==="Parent Details"&&e.jsx("div",{className:"items-center bg-gray-100",children:e.jsx(os,{})}),t==="Bookings"&&e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"flex flex-col mt-6 p-2 pl-6 font-bold text-2xl text-zinc-800 "}),e.jsx(ds,{})]})]})}function us(){const[t,N]=a.useState([]),[h,S]=a.useState({}),p=X(),{currentUser:s}=E(c=>c.user),i=a.useCallback(async c=>{const y=await(await fetch(`/server/booking/getbookings/${c}`)).json();if(y.success===!1)return;const P=y.sort((k,M)=>new Date(M.createdAt)-new Date(k.createdAt));N(P)},[]);a.useEffect(()=>{(async()=>{const y=await(await fetch(`/server/user/providers/${s._id}`)).json();y.success!==!1&&(S(y),y[0]&&i(y[0]._id))})()},[s._id,i]);const b=async c=>{p(Ze(c)).then(async()=>{H.success("Appointment Approved",{position:"bottom-left"}),h[0]&&i(h[0]._id);const j=t.find(k=>k._id===c),P=await(await fetch("/server/booking/emailbookingAccept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:j.patientDetails.email,subject:"1Step Appointment Approved",providerName:h[0].fullName,service:j.service.join(", "),name:s.username,providerProfile:h[0].profilePicture,time:j.scheduledTime})})).json();if(P.success===!1){console.log("Email not sent");return}P.success===!0&&console.log("Email sent")})},x=async c=>{p(es(c)).then(()=>{H.error("Appointment Rejected",{position:"bottom-left"}),h[0]&&i(h[0]._id)})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-auto overflow-x-scroll md:mx-auto p-3 scrollbar scrollbar-track-slate-100 scrollbar-thumb-slate-300",children:t&&t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"Your Appointments :"}),e.jsxs(g,{hoverable:!0,className:"shadow-md w-full",children:[e.jsxs(g.Head,{children:[e.jsx(g.HeadCell,{children:"Patient Name"}),e.jsx(g.HeadCell,{children:"Services they Need"}),e.jsx(g.HeadCell,{children:"Scheduled Time"}),e.jsx(g.HeadCell,{children:"Session Type"}),e.jsx(g.HeadCell,{children:"Note"}),e.jsx(g.HeadCell,{children:"Status"}),e.jsx(g.HeadCell,{children:"Action"})]}),t.map(c=>e.jsx(g.Body,{className:"divide-y",children:e.jsxs(g.Row,{className:"bg-white text-gray-600",children:[e.jsx(g.Cell,{children:c.patientDetails.username}),e.jsx(g.Cell,{children:c.service.join(", ")}),e.jsx(g.Cell,{children:c.scheduledTime}),e.jsx(g.Cell,{children:c.sessionType}),e.jsx(g.Cell,{children:c.note}),e.jsxs(g.Cell,{children:[c.status==="pending"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(De,{})}):"",c.status==="approved"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(Pe,{})}):"",c.status==="rejected"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ke,{})}):""]}),e.jsx(g.Cell,{className:"flex flex-row gap-2",children:c.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(Q.Button,{className:"bg-emerald-600",disabled:c.status==="approved",children:"Accepted"}),e.jsx(Q.Button,{className:"bg-red-500",onClick:()=>x(c._id),children:"Reject"})]}):c.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(Q.Button,{className:"bg-emerald-600",onClick:()=>b(c._id),children:"Accept"}),e.jsx(Q.Button,{className:"bg-red-500",onClick:()=>x(c._id),disabled:c.status==="rejected",children:"Reject"})]}):c.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsx(Q.Button,{className:"bg-emerald-600",onClick:()=>b(c._id),children:"Accepted"}),e.jsx(Q.Button,{className:"bg-red-500",onClick:()=>x(c._id),disabled:c.status==="rejected",children:"Rejected"})]}):""})]})},c._id))]})]}):e.jsx("h1",{className:"text-2xl text-gray font-bold mb-5",children:"No Appointment Yet"})})})}function xs(){const{currentUser:t}=E(r=>r.user),{currentProvider:N}=E(r=>r.provider),{user:h}=E(r=>r.provider),{onlineAllUsers:S}=E(r=>r.online),[p,s]=a.useState([]);console.log("UserDetails",p);const[i,b]=a.useState(""),[x,c]=a.useState(null),[j,y]=a.useState([]),[P,k]=a.useState([]),[M,U]=a.useState([]),F=a.useRef(null),L=a.useRef(null),[f,R]=a.useState(!0),[q,B]=a.useState(!0),[Z,A]=a.useState(!1),O=X(),G="http://localhost:3000",[T,ee]=a.useState(null),[W,se]=a.useState("");a.useEffect(()=>{const r=Ee(G,{withCredentials:!0});return ee(r),r.emit("Online",N._id),r.on("UserOnline",({userId:m})=>{O(Me(m))}),r.on("UserOut",({userId:m})=>{O(Be(m))}),()=>{r.close()}},[N._id,O]),a.useEffect(()=>{if(!T)return;const r=({sender:m,message:o,provider:n,userid:d})=>{if(h!==d){H.success(`new message from ${m}`);return}const u={sender:m,message:o,provider:n,userid:d,createdAt:new Date};k(w=>[...w,u]),U(w=>[...w,u]),s(w=>w.map(D=>D._id===h?{...D,lastMessage:u}:D))};return T.on("receiveMessage",r),()=>T.off("receiveMessage",r)},[T,h]);const te=()=>{W===""&&H.error("Message cannot be empty"),T&&(T.emit("joinRoom",{roomId:`${x._id}_${i}`,sender:t._id,provider:i,reciever:x._id}),T.emit("sendMessage",{roomId:`${x._id}_${i}`,message:W,sender:t._id,provider:i,userid:x._id,reciever:x._id}),se(""))};a.useEffect(()=>{if(x&&T){const r=`${x._id}_${i}`;T.emit("joinRoom",{roomId:r,sender:t._id,provider:i,receiver:x._id})}},[x,T,t._id,i]),a.useEffect(()=>{(async()=>{try{R(!0),L.current.continuousStart(50);const o=await(await fetch(`/server/message/getuserprovider/${t._id}`)).json();if(o.success===!1){R(!1);return}s(o.users),b(o.providerId),R(!1),L.current.complete(50)}catch(m){R(!1),console.log(m)}})()},[t._id]);const ae=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),te())};a.useEffect(()=>{const r=()=>{F.current&&F.current.scrollTop<=50&&le()};if(F.current){const m=F.current;return m.addEventListener("scroll",r),()=>{m&&m.removeEventListener("scroll",r)}}},[M]);const le=()=>{const m=M.length,o=j.slice(Math.max(0,j.length-m-10),j.length-m);U([...o,...M])},l=()=>{if(F.current){const{scrollHeight:r,clientHeight:m}=F.current,o=r-m;F.current.scrollTop=o>0?o:0}};a.useEffect(()=>{l()},[j,P]);const v=()=>{A(!0)},C=async r=>{c(r),A(!1);const m=`${r._id}_${i}`;try{const n=await(await fetch(`/server/message/getmessage/${m}`)).json();if(n.success===!1)return;y(n),U(n.slice(-9));const d=n.filter(u=>!u.read&&u.sender!==t._id);await Promise.all(d.map(async u=>fetch(`/server/message/markasread/${u._id}`,{method:"PUT",headers:{"Content-Type":"application/json"}}))),U(u=>u.map(w=>w.sender!==t._id?{...w,read:!0}:w)),s(u=>u.map(_=>{var D;return _._id===r._id&&((D=_.lastMessage)==null?void 0:D.sender)!==t._id?{..._,lastMessage:{..._.lastMessage,read:!0}}:_}))}catch(o){console.log(o)}};return a.useEffect(()=>{(async()=>{try{B(!0);const o=await(await fetch(`/server/message/getuserprovider/${t._id}`)).json();if(o.success===!1)return;const d=(await Promise.all(o.users.map(async u=>{const w=`${u._id}_${o.providerId}`,[_,D]=await Promise.all([fetch(`/server/message/getlastmessage/${w}`),fetch(`/server/message/getunreadmessagescount/${w}?reciever=${t._id}`)]),I=await _.json(),Y=await D.json();return{...u,lastMessage:I,unreadCount:Y.unreadCount}}))).sort((u,w)=>{const _=new Date(u.lastMessage.createdAt);return new Date(w.lastMessage.createdAt)-_});s(d),B(!1)}catch(m){console.log(m)}})()},[t._id]),e.jsxs("div",{className:"full-height flex flex-col",children:[e.jsx(de,{color:"#722a88",ref:L,height:3,speed:1e3}),f?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:e.jsx(fe,{color:"#AFDBD8",loading:f,size:20})})}):e.jsx(e.Fragment,{children:p.length>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-grow h-screen max-h-[390px] 2xl:max-h-[700px]",children:[e.jsx("div",{className:"w-1/4 chatbg flex flex-col items-center pt-2 pr-2 gap-2",children:p.length>0?e.jsx(e.Fragment,{children:q?e.jsx(e.Fragment,{children:p.map(r=>e.jsxs(Le,{height:80,width:290,speed:2,viewBox:"0 0 250 60",backgroundColor:"#f5f5f5",foregroundColor:"#D1BEE0",className:"2xl:w-[900px] 2xl:h-[110px]",children:[e.jsx("circle",{cx:"127",cy:"35",r:"25",className:"md:hidden block"}),e.jsx("circle",{cx:"30",cy:"35",r:"25",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"20",width:"140",height:"8",rx:"4",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"40",width:"80",height:"8",rx:"4",className:"hidden md:block"})]},r._id))}):e.jsx(e.Fragment,{children:p.map(r=>{var o,n,d,u,w,_;const m=x&&x._id===r._id;return e.jsxs("div",{className:`w-full p-4 flex chatbox-color gap-5 border-b-2 items-center cursor-pointer ${m?"chat-selected":"messagebg"}`,onClick:()=>{O(ss(r._id)),C(r)},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.profilePicture,alt:"provider logo",className:"w-9 h-9 2xl:size-20 md:w-12 md:h-12 rounded-full object-cover"}),S[r._id]?e.jsx(ce,{className:"absolute text-green-400 top-0 right-0 transition-all ease-in duration-150"}):e.jsx(ce,{className:"absolute text-red-400 top-0 right-0  transition-all ease-in duration-150"})]}),e.jsxs("div",{className:"flex-grow hidden md:block",children:[e.jsx("p",{className:"font-semibold items-center justify-center",children:r.username}),e.jsx("div",{className:"flex flex-row gap-1",children:e.jsxs("p",{className:`text-xs md:text-xs line-clamp-1 ${!((o=r.lastMessage)!=null&&o.read)&&((n=r.lastMessage)==null?void 0:n.sender)!==t._id?"text-gray-700 font-bold":""}`,children:[(d=r.lastMessage)==null?void 0:d.message.slice(0,20),((u=r.lastMessage)==null?void 0:u.message.length)>20?".....":""]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{style:{fontSize:"9px"},className:"hidden md:block",children:e.jsx("span",{className:"ml-2",style:{fontSize:"12px"},children:(()=>{var oe;const D=new Date((oe=r.lastMessage)==null?void 0:oe.createdAt),I=new Date,Y=I-D,V=24*60*60*1e3,K=7*V,z=ne=>{const re=new Date(I);return re.setDate(I.getDate()-1),ne.getDate()===re.getDate()&&ne.getMonth()===re.getMonth()&&ne.getFullYear()===re.getFullYear()};return Y<V?D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):z(D)?"Yesterday":Y<K?D.toLocaleDateString([],{weekday:"long"}):D.toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric"})})()})}),e.jsx("div",{children:!((w=r.lastMessage)!=null&&w.read)&&((_=r.lastMessage)==null?void 0:_.sender)!==t._id&&e.jsx("div",{className:"bg-purple-400 rounded-full w-4 h-4 flex justify-center items-center",children:e.jsx("p",{className:"font-bold",style:{fontSize:"10px"},children:r.unreadCount})})})]})]},r._id)})})}):e.jsx(e.Fragment,{children:"no messages found"})}),e.jsx("div",{className:"w-3/4 p-4 flex flex-col rightchatbox-color overflow-hidden",children:x?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:`transition-all ease-in-out duration-200 ${Z?"md:w-3/4":"w-full"}`,children:[e.jsxs("div",{className:`flex flex-row items-center mb-4 justify-between border-b-2 border-purple-500 ${Z?"":"cursor-pointer"}`,onClick:v,children:[e.jsxs("div",{className:"flex item-center mb-4",children:[e.jsx("img",{src:x.profilePicture,alt:"provider logo",className:"size-10 rounded-full object-cover"}),e.jsx("div",{className:"flex flex-row items-center text-start",children:e.jsxs("div",{className:"items-center",children:[e.jsx("h2",{className:"flex flex-row ml-2 capitalize font-semibold",children:x.username}),S[x._id]?e.jsx("div",{className:"text-xs text-start ml-2 transition-all ease-in duration-150",children:"Online"}):e.jsx("div",{className:"text-xs text-start ml-2 transition-all ease-in duration-150",children:"Offline"})]})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(Se,{className:"size-6 text-gray",onClick:v})})]}),e.jsxs("div",{className:"flex flex-col flex-grow h-screen",children:[e.jsx("div",{ref:F,className:"overflow-y-scroll h-[245px] md:h-[240px] 2xl:h-[550px]",children:M.map(r=>e.jsxs("div",{className:"m-2",children:[e.jsxs("div",{className:`flex items-center ${String(r.sender)===String(t._id)?"justify-end":""}`,children:[r.sender!==t._id&&e.jsx("img",{src:x.profilePicture,alt:"user logo",className:"size-8 rounded-full mr-2 object-cover"}),e.jsx("div",{className:`p-2 text-xs md:text-base ${r.sender===t._id?"chat-sender rounded-l-xl rounded-tr-xl":"bg-gray-300 rounded-r-xl rounded-tl-xl"}  ${r.message.length>30?"w-2/3":"w-auto"}`,children:e.jsxs("div",{className:"flex items-center ml-2",children:[r.message,e.jsx("span",{className:"ml-2 mt-1",style:{fontSize:"10px"},children:new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}),r.sender===t._id&&e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-9 rounded-full ml-2 object-cover"})]}),e.jsx("div",{className:`md:text-sm ${r.sender===t._id?"mr-10 text-right":"ml-10 text-left"}`,style:{fontSize:"12px"},children:e.jsx(Re,{locale:"en-US",date:new Date(r.createdAt)})})]},r._id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",required:!0,placeholder:"Type a message...",className:"w-full p-3 rounded-lg",value:W,onKeyDown:ae,onChange:r=>se(r.target.value)}),e.jsx(Q.Button,{onClick:te,variant:"outlined",className:"btn-color border-gray-400",children:e.jsx(_e,{className:"size-5"})})]})]})]}),Z&&e.jsxs("div",{className:"w-1/3 p-2 pr-2 md:block hidden border-l-2 mt-2",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2 mb-3",children:[e.jsx(Ce,{className:"size-6 text-gray cursor-pointer",onClick:()=>A(!1)}),e.jsx("p",{className:"text-base font-semibold",children:"Contact info"})]}),e.jsx(we,{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:x.profilePicture,alt:"user logo",className:"size-10 rounded-full object-cover"}),e.jsx("h2",{className:"capitalize font-semibold mt-2",children:x.username}),e.jsx("p",{className:"text-xs mt-2",children:x.email})]})})]})]}):e.jsxs("div",{className:"flex flex-col mx-auto items-center justify-center h-full",children:[e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-20 object-cover rounded-full border-4 border-purple-300"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray",children:["Hi,",e.jsx("span",{className:"animate-wave",children:"ðŸ‘‹ðŸ»"}),"Welcome!"]}),e.jsx("h2",{className:"text-gray",children:"Select a people for chat."})]})})]})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col w-full max-h-screen p-2 mx-auto",children:e.jsx("div",{className:"h-52vh md:h-72vh bg-provmsgbg bg-cover bg-center flex flex-col justify-center items-center text-white",children:e.jsxs("div",{children:[e.jsx("h1",{className:"flex flex-col items-center text-4xl font-bold  text-gray-700",children:"No messages yet"}),e.jsx("h1",{className:"flex flex-col items-center text-2xl font-semibold mt-6 text-zinc-600",children:"You don't have any messages from client yet."})]})})})})})]})}function hs(){const[t,N]=a.useState("Providers"),{currentProvider:h}=E(s=>s.provider),S=me(),p=a.useMemo(()=>{const s=[{title:"Providers"}];return h&&s.push({title:"Message"},{title:"Appointment"}),s},[h]);return a.useEffect(()=>{const i=new URLSearchParams(S.search).get("tag");i&&p.find(x=>x.title===i)&&N(i)},[S.search,p]),e.jsxs("div",{className:"flex flex-col w-full transition-all duration-500",children:[e.jsx("nav",{className:"block border-b items-start",children:e.jsx("ul",{className:" flex items-center gap-x-3 max-w-screen-2xl mx-auto px-4",children:p.map((s,i)=>e.jsx("li",{className:"py-1",children:e.jsx(ie,{to:`?tag=${s.title}`,className:`block py-2 px-3 rounded-lg md:text-base text-sm text-gray-700 hover:text-amber-500 hover:bg-amber-100 duration-150 ${t===s.title?"border-b-2 border-amber-500":""}`,children:e.jsx("span",{className:"",children:s.title})})},i))})}),t==="Providers"&&e.jsx("div",{className:"w-full min-h-screen transition-all duration-500",children:e.jsx(ls,{})}),h&&e.jsxs(e.Fragment,{children:[t==="Message"&&e.jsxs("div",{className:"w-full min-h-screen transition-all duration-500 h-screen",children:[e.jsx("h1",{className:"flex flex-col font-bold text-2xl text-zinc-800"}),e.jsx(xs,{})]}),t==="Appointment"&&e.jsxs("div",{className:"w-full min-h-screen transition-all duration-500",children:[e.jsx("h1",{className:"flex flex-col mt-6 p-2 pl-6 font-bold text-2xl text-zinc-800"}),e.jsx(us,{})]})]})]})}function Ct(){const t=me(),[N,h]=a.useState("Dashboard"),{currentUser:S}=E(s=>s.user),p=X();return a.useEffect(()=>{(async()=>{const i=`/server/booking/getuserbookings/${S._id}`;console.log("Fetching bookings from URL:",i);try{p($e());const b=await fetch(i);if(console.log("Response status:",b.status),!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const x=await b.json();p(Fe(x)),console.log("Booking data:",x)}catch(b){p(Te(b)),console.error("An error occurred while fetching booking details:",b)}})()},[S._id,p]),a.useEffect(()=>{const i=new URLSearchParams(t.search).get("tab");["dashboard","providers","profile","Profile Setting","Parent Details","Bookings","messages"].includes(i)&&h(i)},[t.search]),a.useEffect(()=>{const i=new URLSearchParams(t.search).get("tag");["dashboard","providers","profile","Profile Setting","Parent Details","Bookings","messages"].includes(i)&&h(i)},[t.search]),e.jsxs("div",{className:"min-h-screen h-full flex flex-col mx-auto",children:[e.jsx("div",{className:"w-full",children:e.jsx(ns,{})}),N==="dashboard"&&e.jsx(is,{}),N==="providers"&&e.jsx(hs,{}),(N==="profile"||N==="Profile Setting"||N==="Parent Details"||N==="Bookings")&&e.jsx(ms,{}),N==="messages"&&e.jsx(cs,{})]})}export{Ct as default};
