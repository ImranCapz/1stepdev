import{j as e,r as l}from"./react-DiIsFRGf.js";import{u as P,a as J}from"./react-redux-Cmcgb_ry.js";import{O as we,N as ye,a as ae}from"./react-router-Ck6p_Z-K.js";import{c as E,C as me,T as _e}from"./flowbite-react-moIAvRiJ.js";import{u as Se,G as Me,J as ke,K as De,w as Pe,N as se,O as xe,Q as fe,T as he,d as $e,k as Ce,U as Le,V as Be}from"./react-icons-4Z_jIp8v.js";import{L as H}from"./react-router-dom-Cj7EZRaW.js";import{e as Ee,f as ue,g as ge}from"./Header.jsx-DRWgs81u.js";import{p as Re,s as ze,c as Ue,C as Fe}from"./CreateProvider.jsx-CujhAS3a.js";import Te from"./Profile.jsx-Dg7cL2V7.js";import{P as Ae}from"./parents-B7ki2wcR.js";import{r as pe}from"./@material-tailwind-CfbTshu2.js";import{l as je}from"./socket.io-client-DFi9RC7o.js";import{_ as te}from"./react-hot-toast-BDpxPdYe.js";import{S as Ie}from"./SearchBar.jsx-D6SmUb86.js";import{u as ie}from"./react-top-loading-bar-BLjLFdAM.js";import{s as ce,a as de,U as Oe,P as He,g as Ye,b as Ke,c as We}from"./booking-BbWidloJ.js";import{_ as ve}from"./react-spinners-D_wes01j.js";import{C as Ne}from"./react-content-loader-DBgsaXRA.js";import"./mongoose-DJKLpne1.js";import{R as be}from"./react-time-ago-D1AjiSwC.js";function Ns(){const{currentUser:t}=P(f=>f.user);return t?e.jsx(we,{}):e.jsx(ye,{to:"/"})}function Ge(){const t=ae(),[f,w]=l.useState(""),v=J();P(a=>a.user),l.useEffect(()=>{const o=new URLSearchParams(t.search).get("tab");o&&w(o)},[t.search]);const h=async()=>{try{const a=await fetch("/server/auth/signout",{method:"GET"}),o=await a.json();a.ok?(v(Re()),v(Ee())):console.log(o.message)}catch(a){console.log(a.message)}};return e.jsx(E,{className:"w-full items-center justify-center mx-auto",children:e.jsx(E.Items,{children:e.jsxs(E.ItemGroup,{className:"flex flex-row gap-2 items-center",children:[e.jsx(H,{to:"/dashboard?tab=dashboard",children:e.jsx(E.Item,{active:f==="dashboard",className:"mt-2",icon:Se,labelColor:"light",as:"div",children:"Dashboard"})}),e.jsx(H,{to:"/dashboard?tab=providers",children:e.jsx(E.Item,{active:f==="providers",icon:Me,labelColor:"light",as:"div",children:"Providers"})}),e.jsx(H,{to:"/dashboard?tab=messages",children:e.jsx(E.Item,{active:f==="messages",icon:ke,labelColor:"light",as:"div",children:"Message"})}),e.jsx(H,{to:"/dashboard?tab=profile",children:e.jsx(E.Item,{active:f==="profile",icon:De,labelColor:"light",as:"div",children:"Profile"})}),e.jsx(E.Item,{icon:Pe,className:"cursor-pointer",onClick:h,children:"Sign Out"})]})})})}function Ve(){return e.jsx("div",{children:"Overview Component"})}function qe(){const{currentUser:t}=P(r=>r.user),{onlineAllUsers:f}=P(r=>r.online),{id:w}=P(r=>r.provider),[v,h]=l.useState([]),[a,o]=l.useState(null),[y,m]=l.useState([]),[R,j]=l.useState([]),[_,$]=l.useState([]),[L,M]=l.useState(!0),[A,k]=l.useState(!0),C=l.useRef(null),z=l.useRef(null),[B,Y]=l.useState(!1),U=J(),K="http://localhost:3000",[S,I]=l.useState(null),[W,D]=l.useState("");l.useEffect(()=>{const r=je(K,{withCredentials:!0});return I(r),r.emit("Online",t._id),r.on("UserOnline",({userId:d})=>{U(ue(d))}),r.on("UserOut",({userId:d})=>{U(ge(d))}),()=>r.close()},[t._id,U]),l.useEffect(()=>{if(!S)return;const r=({sender:d,message:p,provider:s})=>{if(s!==w){te.success("New message received");return}const i={sender:d,message:p,provider:s,createdAt:new Date};j(n=>[...n,i]),$(n=>[...n,i]),h(n=>n.map(x=>x._id===w?{...x,lastMessage:i}:x))};return S.on("receiveMessage",r),()=>S.off("receiveMessage",r)},[S,w]);const Q=()=>{if(W==="")return te.error("Message cannot be empty");S&&(S.emit("joinRoom",{roomId:`${t._id}_${a._id}`,sender:t._id,provider:a._id,reciever:a.userRef}),S.emit("sendMessage",{roomId:`${t._id}_${a._id}`,message:W,sender:t._id,provider:a._id,userid:t._id,reciever:a.userRef}),D(""))};l.useEffect(()=>{if(a&&S){const r=`${t._id}_${a._id}`;return S.emit("joinRoom",{roomId:r,sender:t._id,provider:a._id,reciever:a.userRef}),S.on("messageRead",d=>{$(p=>p.map(s=>s._id===d?{...s,read:!0}:s))}),()=>{S.off("messageRead")}}},[a,S,t._id]),l.useEffect(()=>{(async()=>{M(!0),z.current.continuousStart();try{const p=await(await fetch(`/server/message/getprovider/${t._id}`)).json();if(p.success===!1){M(!1),k(!1);return}h(p),z.current.complete(50),M(!1)}catch(d){M(!1),console.log(d)}})()},[t._id]);const G=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),Q())};l.useEffect(()=>{const r=()=>{C.current&&C.current.scrollTop<=10&&X()};if(C.current){const d=C.current;return d.addEventListener("scroll",r),()=>{d&&d.removeEventListener("scroll",r)}}},[_]);const X=()=>{const d=_.length,p=y.slice(Math.max(0,y.length-d-10),y.length-d);$(s=>[...p,...s])},Z=()=>{if(C.current){const{scrollHeight:r,clientHeight:d}=C.current,p=r-d;C.current.scrollTop=p>0?p:0}};l.useEffect(()=>{Z()},[R,y]);const re=()=>{Y(!0)},le=async r=>{o(r),Y(!1);const d=`${t._id}_${r._id}`;try{const s=await(await fetch(`/server/message/getmessage/${d}`)).json();if(s.success===!1)return;m(s),$(s.slice(-10));const i=s.filter(n=>!n.read&&n.sender!==t._id);console.log("unreadMessages",i),await Promise.all(i.map(async n=>fetch(`/server/message/markasread/${n._id}`,{method:"PUT",headers:{"Content-Type":"application/json"}}))),$(n=>n.map(u=>u.sender!==t._id?{...u,read:!0}:u)),h(n=>n.map(x=>{var c;return x._id===r._id&&((c=x.lastMessage)==null?void 0:c.sender)!==t._id?{...x,lastMessage:{...x.lastMessage,read:!0}}:x}))}catch(p){console.log(p)}};return l.useEffect(()=>{(async()=>{try{M(!0),k(!0);const p=await(await fetch(`/server/message/getprovider/${t._id}`)).json();if(p.success===!1){M(!1),k(!1);return}const i=(await Promise.all(p.map(async n=>{const u=`${t._id}_${n._id}`,[x,c]=await Promise.all([fetch(`/server/message/getlastmessage/${u}`),fetch(`/server/message/getunreadmessagescount/${u}?reciever=${t._id}`)]),g=await x.json(),N=await c.json();return console.log("unreadData",N),{...n,lastMessage:g||"No message yet",unreadCount:N.unreadCount}}))).sort((n,u)=>{const x=new Date(n.lastMessage.createdAt);return new Date(u.lastMessage.createdAt)-x});h(i),k(!1),M(!1)}catch(d){M(!1),console.log(d)}})()},[t._id]),e.jsxs("div",{className:"full-height flex flex-col",children:[e.jsx(ie,{color:"#722a88",ref:z,height:3,speed:1e3}),L?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh"},children:e.jsx(ve,{color:"#AFDBD8",loading:L,size:20})})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{color:"#ff9900",ref:z,height:3,speed:1e3}),v.length>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-grow h-screen max-h-[460px] 2xl:max-h-[745px]",children:[e.jsx("div",{className:"w-1/4 flex flex-col items-center pt-2 pr-2 gap-2",children:v.length>0?e.jsx(e.Fragment,{children:A&&!L?e.jsx(e.Fragment,{children:v.map(r=>e.jsxs(Ne,{height:80,width:290,speed:2,viewBox:"0 0 250 60",backgroundColor:"#f5f5f5",foregroundColor:"#D1BEE0",className:"2xl:w-[900px] 2xl:h-[110px]",children:[e.jsx("circle",{cx:"127",cy:"35",r:"25",className:"md:hidden block"}),e.jsx("circle",{cx:"30",cy:"35",r:"25",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"20",width:"140",height:"8",rx:"4",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"40",width:"80",height:"8",rx:"4",className:"hidden md:block"})]},r._id))}):e.jsx(e.Fragment,{children:v.map(r=>{var p,s,i,n,u,x;const d=a&&a._id===r._id;return e.jsxs("div",{className:`w-full p-4 flex chatbox-color gap-5 border-b-2 items-center cursor-pointer ${d?"chat-selected":"messagebg"}`,onClick:()=>{U(ze(r._id)),le(r)},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.profilePicture,alt:"provider logo",className:"w-9 h-9 2xl:size-20 md:w-12 md:h-12 rounded-full object-cover"}),f[r._id]?e.jsx(se,{className:"absolute top-0 right-0 text-green-400 transition-all ease-in duration-150"}):e.jsx(se,{className:"absolute top-0 right-0 text-red-400 transition-all ease-in duration-150"})]}),e.jsxs("div",{className:"flex-grow hidden md:block",children:[e.jsx("p",{className:"font-semibold items-center justify-center",children:r.fullName.slice(0,15)}),e.jsx("div",{className:"flex flex-row gap-1",children:e.jsxs("p",{className:`text-sm line-clamp-1 ${!((p=r.lastMessage)!=null&&p.read)&&((s=r.lastMessage)==null?void 0:s.sender)!==t._id?"text-gray-700 font-bold":""}`,children:[(i=r.lastMessage)==null?void 0:i.message.slice(0,20),((n=r.lastMessage)==null?void 0:n.message.length)>20?"....":""]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{style:{fontSize:"11px"},className:"hidden md:block",children:e.jsx("span",{className:"ml-2",style:{fontSize:"12px"},children:(()=>{var V;const c=new Date(((V=r.lastMessage)==null?void 0:V.createdAt)||0),g=new Date,N=g-c,b=24*60*60*1e3,F=7*b,O=q=>{const T=new Date(g);return T.setDate(T.getDate()-1),q.getDate()===T.getDate()&&q.getMonth()===T.getMonth()&&q.getFullYear()===T.getFullYear()};return N<b?c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):O(c)?"Yesterday":N<F?c.toLocaleDateString([],{weekday:"long"}):c.toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric"})})()})}),e.jsx("div",{children:!((u=r.lastMessage)!=null&&u.read)&&((x=r.lastMessage)==null?void 0:x.sender)!==t._id&&e.jsx("div",{className:"bg-purple-400 rounded-full w-4 h-4 flex justify-center items-center",children:e.jsx("p",{className:"font-bold",style:{fontSize:"10px"},children:r.unreadCount})})})]})]},r._id)})})}):e.jsx(e.Fragment,{children:"no messages found"})}),e.jsx("div",{className:"w-3/4 p-4 flex flex-col rightchatbox-color overflow-hidden",children:a?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:`transition-all ease-in-out duration-200 ${B?"md:w-3/4":"w-full"}`,children:[e.jsxs("div",{className:`flex flex-row items-center mb-4 justify-between border-b-2 border-purple-500 ${B?"":"cursor-pointer"}`,onClick:re,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("img",{src:a.profilePicture,alt:"provider logo",className:"w-12 h-10 md:h-12 md rounded-full object-cover"}),e.jsx("div",{className:"flex flex-row items-center text-start",children:e.jsxs("div",{className:"items-center",children:[e.jsx("h2",{className:"flex flex-row ml-2 capitalize font-semibold",children:a.fullName}),f[a._id]?e.jsx("div",{className:"text-xs text-start ml-2 fadeIn",children:"Online"}):e.jsx("div",{className:"text-xs text-start  ml-2",children:"Offline"})]})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(xe,{className:"size-6"})})]}),e.jsxs("div",{className:"flex flex-col flex-grow h-screen",children:[e.jsx("div",{ref:C,className:" overflow-y-scroll h-[320px] md:h-[290px] 2xl:h-[600px]",children:_.map(r=>e.jsxs("div",{className:"m-2",children:[e.jsxs("div",{className:`flex items-center ${String(r.sender)===String(t._id)?"justify-end":""}`,children:[r.sender!==t._id&&e.jsx("img",{src:a.profilePicture,alt:"provider logo",className:"size-9 rounded-full mr-2 object-cover"}),e.jsxs("div",{className:`p-2 text-xs md:text-base ${r.sender===t._id?"chat-sender rounded-l-xl rounded-tr-xl":"bg-gray-300 rounded-r-xl rounded-tl-xl"} ${r.message.length>30?"w-2/3":"w-max"}`,children:[r.message,e.jsx("span",{className:"ml-2",style:{fontSize:"10px"},children:new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),r.sender===t._id&&e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-9 rounded-full ml-2 object-cover"})]}),e.jsx("div",{className:`${r.sender===t._id?"mr-10 text-right":"ml-10 text-left"}`,style:{fontSize:"12px"},children:e.jsx(be,{locale:"en-US",date:new Date(r.createdAt)})})]},r._id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Type a message...",className:"w-full p-3 rounded-lg",value:W,onKeyDown:G,onChange:r=>D(r.target.value)}),e.jsx(pe.Button,{onClick:Q,variant:"outlined",className:"btn-color border-gray-400",children:e.jsx(fe,{className:"size-5"})})]})]})]}),B&&e.jsxs("div",{className:"w-1/3 p-2 pr-2 md:block hidden border-l-2 mt-2",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2 mb-3",children:[e.jsx(he,{className:"size-6 text-gray cursor-pointer",onClick:()=>Y(!1)}),e.jsx("p",{className:"text-base font-semibold",children:"Contact info"})]}),e.jsx(me,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:a.profilePicture,alt:"user logo",className:"size-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row justify-center items-center gap-1",children:[e.jsx("h2",{className:"capitalize font-semibold mt-2 provideritem-name",children:a.fullName}),a.verified===!0&&e.jsx(e.Fragment,{children:e.jsx(_e,{content:"Verifed Profile",animation:"duration-500",children:e.jsx($e,{className:"animate-bounce size-4 mt-2"})})})]}),e.jsx("p",{className:"text-xs text-center provideritem-service",children:Array.isArray(a.name)?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.name.slice(0,2).join(", ")}),a.name.length>2?e.jsx("p",{children:a.name.slice(2).join(", ")}):null,a.name.length>3?e.jsx(e.Fragment,{children:e.jsx("p",{children:`+${a.name.length-2}more`})}):null]}):e.jsx(e.Fragment,{children:a.name})})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(Ce,{className:"h-4 w-4 icon-color"}),e.jsxs("p",{className:"text-sm provideritem-service",children:[e.jsx("span",{className:"text-xs provideritem-service",children:a.experience}),"Â years experience"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-4 w-4 icon-color"}),e.jsxs("p",{className:"text-sm provideritem-service truncate w-full",children:[a.address.state,",",a.address.city]})]})]})})]})]}):e.jsxs("div",{className:"flex flex-col mx-auto items-center justify-center h-full",children:[e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-20 object-cover rounded-full border-4 border-purple-300"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray",children:["Hi,",e.jsx("span",{className:"animate-wave",children:"ðŸ‘‹ðŸ»"}),"Welcome!"]}),e.jsx("h2",{className:"text-gray",children:"Select a provider for chat."})]})})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col w-full max-h-screen p- mx-auto",children:[e.jsx("div",{className:"h-52vh md:h-72vh bg-nomsgbg bg-cover bg-center flex flex-col justify-center items-center text-white",children:e.jsxs("div",{children:[e.jsx("h1",{className:"flex flex-col items-center text-4xl font-bold  text-gray-700",children:"No Messages yet"}),e.jsx("h1",{className:"flex flex-col items-center text-2xl font-semibold mt-6 text-zinc-600",children:"To begin, search for a provider and send them a message."})]})}),e.jsx("div",{className:"flex items-center justify-center mt-6",children:e.jsx(Ie,{})})]})})]})]})}function Je(){const[t,f]=l.useState("Profile setting");P(j=>j.user);const[w,v]=l.useState(!1),h=ae(),a=J(),{bookings:o,hasApprovedBooking:y,lastSeenBookingId:m}=P(j=>j.booking),R=l.useMemo(()=>[{title:"Profile setting"},{title:"Parent Details"},{title:"Bookings"}],[]);return l.useEffect(()=>{t!=="Bookings"&&v(!1)},[t]),l.useEffect(()=>{if(Array.isArray(o)){const j=o.filter(_=>_.status==="approved");if(j.length>0){const _=j[j.length-1];_._id!==m&&(a(ce(!0)),a(de(_._id)))}}},[o,a,m]),l.useEffect(()=>{const _=new URLSearchParams(h.search).get("tag");_&&R.find(L=>L.title===_)&&f(_)},[h.search,R]),e.jsxs("div",{className:"flex flex-col w-full transition-all duration-500 ",children:[e.jsx("nav",{className:"block border-b items-start",children:e.jsx("ul",{className:" flex items-center gap-x-3 max-w-screen-2xl mx-auto px-4 overflow-x-auto lg:px-8",children:R.map((j,_)=>e.jsx("li",{className:"py-1",children:e.jsx(H,{to:`?tag=${j.title}`,className:`block py-2 px-3 rounded-lg md:text-base text-sm text-gray-700 hover:text-amber-500 hover:bg-amber-100 duration-150 ${t===j.title?"border-b-2 border-amber-500":""}`,onClick:()=>{if(j.title==="Bookings"){v(!1);const $=o.filter(L=>L.status==="approved");if($.length>0){const L=$[$.length-1];a(de(L._id)),a(ce(!1))}}},children:e.jsxs("span",{className:"flex flex-row items-center gap-1",children:[j.title,j.title==="Bookings"&&y&&e.jsx(Be,{})]})})},_))})}),t==="Profile setting"&&e.jsx("div",{className:"w-full min-h-screen transition-all duration-500",children:e.jsx(Te,{})}),t==="Parent Details"&&e.jsx("div",{className:"items-center bg-gray-100",children:e.jsx(Ae,{})}),t==="Bookings"&&e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"flex flex-col mt-6 p-2 pl-6 font-bold text-2xl text-zinc-800 "}),e.jsx(Oe,{})]})]})}function Qe(){const{currentUser:t}=P(s=>s.user),{currentProvider:f}=P(s=>s.provider),{user:w}=P(s=>s.provider),{onlineAllUsers:v}=P(s=>s.online),[h,a]=l.useState([]);console.log("UserDetails",h);const[o,y]=l.useState(""),[m,R]=l.useState(null),[j,_]=l.useState([]),[$,L]=l.useState([]),[M,A]=l.useState([]),k=l.useRef(null),C=l.useRef(null),[z,B]=l.useState(!0),[Y,U]=l.useState(!0),[K,S]=l.useState(!1),I=J(),W="http://localhost:3000",[D,Q]=l.useState(null),[G,X]=l.useState("");l.useEffect(()=>{const s=je(W,{withCredentials:!0});return Q(s),s.emit("Online",f._id),s.on("UserOnline",({userId:i})=>{I(ue(i))}),s.on("UserOut",({userId:i})=>{I(ge(i))}),()=>{s.close()}},[f._id,I]),l.useEffect(()=>{if(!D)return;const s=({sender:i,message:n,provider:u,userid:x})=>{if(w!==x){te.success(`new message from ${i}`);return}const c={sender:i,message:n,provider:u,userid:x,createdAt:new Date};L(g=>[...g,c]),A(g=>[...g,c]),a(g=>g.map(b=>b._id===w?{...b,lastMessage:c}:b))};return D.on("receiveMessage",s),()=>D.off("receiveMessage",s)},[D,w]);const Z=()=>{G===""&&te.error("Message cannot be empty"),D&&(D.emit("joinRoom",{roomId:`${m._id}_${o}`,sender:t._id,provider:o,reciever:m._id}),D.emit("sendMessage",{roomId:`${m._id}_${o}`,message:G,sender:t._id,provider:o,userid:m._id,reciever:m._id}),X(""))};l.useEffect(()=>{if(m&&D){const s=`${m._id}_${o}`;D.emit("joinRoom",{roomId:s,sender:t._id,provider:o,receiver:m._id})}},[m,D,t._id,o]),l.useEffect(()=>{(async()=>{try{B(!0),C.current.continuousStart(50);const n=await(await fetch(`/server/message/getuserprovider/${t._id}`)).json();if(n.success===!1){B(!1);return}a(n.users),y(n.providerId),B(!1),C.current.complete(50)}catch(i){B(!1),console.log(i)}})()},[t._id]);const re=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Z())};l.useEffect(()=>{const s=()=>{k.current&&k.current.scrollTop<=50&&le()};if(k.current){const i=k.current;return i.addEventListener("scroll",s),()=>{i&&i.removeEventListener("scroll",s)}}},[M]);const le=()=>{const i=M.length,n=j.slice(Math.max(0,j.length-i-10),j.length-i);A([...n,...M])},r=()=>{if(k.current){const{scrollHeight:s,clientHeight:i}=k.current,n=s-i;k.current.scrollTop=n>0?n:0}};l.useEffect(()=>{r()},[j,$]);const d=()=>{S(!0)},p=async s=>{R(s),S(!1);const i=`${s._id}_${o}`;try{const u=await(await fetch(`/server/message/getmessage/${i}`)).json();if(u.success===!1)return;_(u),A(u.slice(-9));const x=u.filter(c=>!c.read&&c.sender!==t._id);await Promise.all(x.map(async c=>fetch(`/server/message/markasread/${c._id}`,{method:"PUT",headers:{"Content-Type":"application/json"}}))),A(c=>c.map(g=>g.sender!==t._id?{...g,read:!0}:g)),a(c=>c.map(N=>{var b;return N._id===s._id&&((b=N.lastMessage)==null?void 0:b.sender)!==t._id?{...N,lastMessage:{...N.lastMessage,read:!0}}:N}))}catch(n){console.log(n)}};return l.useEffect(()=>{(async()=>{try{U(!0);const n=await(await fetch(`/server/message/getuserprovider/${t._id}`)).json();if(n.success===!1)return;const x=(await Promise.all(n.users.map(async c=>{const g=`${c._id}_${n.providerId}`,[N,b]=await Promise.all([fetch(`/server/message/getlastmessage/${g}`),fetch(`/server/message/getunreadmessagescount/${g}?reciever=${t._id}`)]),F=await N.json(),O=await b.json();return{...c,lastMessage:F,unreadCount:O.unreadCount}}))).sort((c,g)=>{const N=new Date(c.lastMessage.createdAt);return new Date(g.lastMessage.createdAt)-N});a(x),U(!1)}catch(i){console.log(i)}})()},[t._id]),e.jsxs("div",{className:"full-height flex flex-col",children:[e.jsx(ie,{color:"#722a88",ref:C,height:3,speed:1e3}),z?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:e.jsx(ve,{color:"#AFDBD8",loading:z,size:20})})}):e.jsx(e.Fragment,{children:h.length>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-grow h-screen max-h-[390px] 2xl:max-h-[700px]",children:[e.jsx("div",{className:"w-1/4 chatbg flex flex-col items-center pt-2 pr-2 gap-2",children:h.length>0?e.jsx(e.Fragment,{children:Y?e.jsx(e.Fragment,{children:h.map(s=>e.jsxs(Ne,{height:80,width:290,speed:2,viewBox:"0 0 250 60",backgroundColor:"#f5f5f5",foregroundColor:"#D1BEE0",className:"2xl:w-[900px] 2xl:h-[110px]",children:[e.jsx("circle",{cx:"127",cy:"35",r:"25",className:"md:hidden block"}),e.jsx("circle",{cx:"30",cy:"35",r:"25",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"20",width:"140",height:"8",rx:"4",className:"hidden md:block"}),e.jsx("rect",{x:"70",y:"40",width:"80",height:"8",rx:"4",className:"hidden md:block"})]},s._id))}):e.jsx(e.Fragment,{children:h.map(s=>{var n,u,x,c,g,N;const i=m&&m._id===s._id;return e.jsxs("div",{className:`w-full p-4 flex chatbox-color gap-5 border-b-2 items-center cursor-pointer ${i?"chat-selected":"messagebg"}`,onClick:()=>{I(Ue(s._id)),p(s)},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.profilePicture,alt:"provider logo",className:"w-9 h-9 2xl:size-20 md:w-12 md:h-12 rounded-full object-cover"}),v[s._id]?e.jsx(se,{className:"absolute text-green-400 top-0 right-0 transition-all ease-in duration-150"}):e.jsx(se,{className:"absolute text-red-400 top-0 right-0  transition-all ease-in duration-150"})]}),e.jsxs("div",{className:"flex-grow hidden md:block",children:[e.jsx("p",{className:"font-semibold items-center justify-center",children:s.username}),e.jsx("div",{className:"flex flex-row gap-1",children:e.jsxs("p",{className:`text-xs md:text-xs line-clamp-1 ${!((n=s.lastMessage)!=null&&n.read)&&((u=s.lastMessage)==null?void 0:u.sender)!==t._id?"text-gray-700 font-bold":""}`,children:[(x=s.lastMessage)==null?void 0:x.message.slice(0,20),((c=s.lastMessage)==null?void 0:c.message.length)>20?".....":""]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{style:{fontSize:"9px"},className:"hidden md:block",children:e.jsx("span",{className:"ml-2",style:{fontSize:"12px"},children:(()=>{var oe;const b=new Date((oe=s.lastMessage)==null?void 0:oe.createdAt),F=new Date,O=F-b,V=24*60*60*1e3,q=7*V,T=ne=>{const ee=new Date(F);return ee.setDate(F.getDate()-1),ne.getDate()===ee.getDate()&&ne.getMonth()===ee.getMonth()&&ne.getFullYear()===ee.getFullYear()};return O<V?b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):T(b)?"Yesterday":O<q?b.toLocaleDateString([],{weekday:"long"}):b.toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric"})})()})}),e.jsx("div",{children:!((g=s.lastMessage)!=null&&g.read)&&((N=s.lastMessage)==null?void 0:N.sender)!==t._id&&e.jsx("div",{className:"bg-purple-400 rounded-full w-4 h-4 flex justify-center items-center",children:e.jsx("p",{className:"font-bold",style:{fontSize:"10px"},children:s.unreadCount})})})]})]},s._id)})})}):e.jsx(e.Fragment,{children:"no messages found"})}),e.jsx("div",{className:"w-3/4 p-4 flex flex-col rightchatbox-color overflow-hidden",children:m?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:`transition-all ease-in-out duration-200 ${K?"md:w-3/4":"w-full"}`,children:[e.jsxs("div",{className:`flex flex-row items-center mb-4 justify-between border-b-2 border-purple-500 ${K?"":"cursor-pointer"}`,onClick:d,children:[e.jsxs("div",{className:"flex item-center mb-4",children:[e.jsx("img",{src:m.profilePicture,alt:"provider logo",className:"size-10 rounded-full object-cover"}),e.jsx("div",{className:"flex flex-row items-center text-start",children:e.jsxs("div",{className:"items-center",children:[e.jsx("h2",{className:"flex flex-row ml-2 capitalize font-semibold",children:m.username}),v[m._id]?e.jsx("div",{className:"text-xs text-start ml-2 transition-all ease-in duration-150",children:"Online"}):e.jsx("div",{className:"text-xs text-start ml-2 transition-all ease-in duration-150",children:"Offline"})]})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(xe,{className:"size-6 text-gray",onClick:d})})]}),e.jsxs("div",{className:"flex flex-col flex-grow h-screen",children:[e.jsx("div",{ref:k,className:"overflow-y-scroll h-[245px] md:h-[240px] 2xl:h-[550px]",children:M.map(s=>e.jsxs("div",{className:"m-2",children:[e.jsxs("div",{className:`flex items-center ${String(s.sender)===String(t._id)?"justify-end":""}`,children:[s.sender!==t._id&&e.jsx("img",{src:m.profilePicture,alt:"user logo",className:"size-8 rounded-full mr-2 object-cover"}),e.jsx("div",{className:`p-2 text-xs md:text-base ${s.sender===t._id?"chat-sender rounded-l-xl rounded-tr-xl":"bg-gray-300 rounded-r-xl rounded-tl-xl"}  ${s.message.length>30?"w-2/3":"w-auto"}`,children:e.jsxs("div",{className:"flex items-center ml-2",children:[s.message,e.jsx("span",{className:"ml-2 mt-1",style:{fontSize:"10px"},children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}),s.sender===t._id&&e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-9 rounded-full ml-2 object-cover"})]}),e.jsx("div",{className:`md:text-sm ${s.sender===t._id?"mr-10 text-right":"ml-10 text-left"}`,style:{fontSize:"12px"},children:e.jsx(be,{locale:"en-US",date:new Date(s.createdAt)})})]},s._id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",required:!0,placeholder:"Type a message...",className:"w-full p-3 rounded-lg",value:G,onKeyDown:re,onChange:s=>X(s.target.value)}),e.jsx(pe.Button,{onClick:Z,variant:"outlined",className:"btn-color border-gray-400",children:e.jsx(fe,{className:"size-5"})})]})]})]}),K&&e.jsxs("div",{className:"w-1/3 p-2 pr-2 md:block hidden border-l-2 mt-2",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2 mb-3",children:[e.jsx(he,{className:"size-6 text-gray cursor-pointer",onClick:()=>S(!1)}),e.jsx("p",{className:"text-base font-semibold",children:"Contact info"})]}),e.jsx(me,{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:m.profilePicture,alt:"user logo",className:"size-10 rounded-full object-cover"}),e.jsx("h2",{className:"capitalize font-semibold mt-2",children:m.username}),e.jsx("p",{className:"text-xs mt-2",children:m.email})]})})]})]}):e.jsxs("div",{className:"flex flex-col mx-auto items-center justify-center h-full",children:[e.jsx("img",{src:t.profilePicture,alt:"user logo",className:"size-20 object-cover rounded-full border-4 border-purple-300"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray",children:["Hi,",e.jsx("span",{className:"animate-wave",children:"ðŸ‘‹ðŸ»"}),"Welcome!"]}),e.jsx("h2",{className:"text-gray",children:"Select a people for chat."})]})})]})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col w-full max-h-screen p-2 mx-auto",children:e.jsx("div",{className:"h-52vh md:h-72vh bg-provmsgbg bg-cover bg-center flex flex-col justify-center items-center text-white",children:e.jsxs("div",{children:[e.jsx("h1",{className:"flex flex-col items-center text-4xl font-bold  text-gray-700",children:"No messages yet"}),e.jsx("h1",{className:"flex flex-col items-center text-2xl font-semibold mt-6 text-zinc-600",children:"You don't have any messages from client yet."})]})})})})})]})}function Xe(){const[t,f]=l.useState("Providers"),{currentProvider:w}=P(a=>a.provider),v=ae(),h=l.useMemo(()=>{const a=[{title:"Providers"}];return w&&a.push({title:"Message"},{title:"Appointment"}),a},[w]);return l.useEffect(()=>{const o=new URLSearchParams(v.search).get("tag");o&&h.find(m=>m.title===o)&&f(o)},[v.search,h]),e.jsxs("div",{className:"flex flex-col w-full transition-all duration-500",children:[e.jsx("nav",{className:"block border-b items-start",children:e.jsx("ul",{className:" flex items-center gap-x-3 max-w-screen-2xl mx-auto px-4",children:h.map((a,o)=>e.jsx("li",{className:"py-1",children:e.jsx(H,{to:`?tag=${a.title}`,className:`block py-2 px-3 rounded-lg md:text-base text-sm text-gray-700 hover:text-amber-500 hover:bg-amber-100 duration-150 ${t===a.title?"border-b-2 border-amber-500":""}`,children:e.jsx("span",{className:"",children:a.title})})},o))})}),t==="Providers"&&e.jsx("div",{className:"w-full min-h-screen transition-all duration-500",children:e.jsx(Fe,{})}),w&&e.jsxs(e.Fragment,{children:[t==="Message"&&e.jsxs("div",{className:"w-full min-h-screen transition-all duration-500 h-screen",children:[e.jsx("h1",{className:"flex flex-col font-bold text-2xl text-zinc-800"}),e.jsx(Qe,{})]}),t==="Appointment"&&e.jsxs("div",{className:"w-full min-h-screen transition-all duration-500",children:[e.jsx("h1",{className:"flex flex-col mt-6 p-2 pl-6 font-bold text-2xl text-zinc-800"}),e.jsx(He,{})]})]})]})}function Ze(){const t=ae(),[f,w]=l.useState("Dashboard"),{currentUser:v}=P(a=>a.user),h=J();return l.useEffect(()=>{(async()=>{const o=`/server/booking/getuserbookings/${v._id}`;console.log("Fetching bookings from URL:",o);try{h(Ye());const y=await fetch(o);if(console.log("Response status:",y.status),!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const m=await y.json();h(Ke(m)),console.log("Booking data:",m)}catch(y){h(We(y)),console.error("An error occurred while fetching booking details:",y)}})()},[v._id,h]),l.useEffect(()=>{const o=new URLSearchParams(t.search).get("tab");["dashboard","providers","profile","Profile Setting","Parent Details","Bookings","messages"].includes(o)&&w(o)},[t.search]),l.useEffect(()=>{const o=new URLSearchParams(t.search).get("tag");["dashboard","providers","profile","Profile Setting","Parent Details","Bookings","messages"].includes(o)&&w(o)},[t.search]),e.jsxs("div",{className:"min-h-screen h-full flex flex-col mx-auto",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ge,{})}),f==="dashboard"&&e.jsx(Ve,{}),f==="providers"&&e.jsx(Xe,{}),(f==="profile"||f==="Profile Setting"||f==="Parent Details"||f==="Bookings")&&e.jsx(Je,{}),f==="messages"&&e.jsx(qe,{})]})}const bs=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{Ns as D,bs as a};
